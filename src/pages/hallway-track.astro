---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { formatMarkdown } from '../utils/formatMarkdown';
import FitList from '../components/FitList.astro';

const emailSubject = "Founding Member Application";
const emailBody = `Hi Andrea,

I'd like to apply to become a founding member of the Debugging Human Communication community. I understand that founding members commit to active participation for at least 6 months.

Name:

LinkedIn:

Who referred me:

Why I'm interested in participating:





Looking forward to hearing from you!`;

const ctaUrl = `mailto:andrea@debugginghumancommunication.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;

const allContent = await getCollection('hallway-track-page');
const page = allContent[0].data;
---

<Layout
  title="You're Invited | Debugging Human Communication"
  description="Join the founding community of Debugging Human Communication. A perpetual hallway track for people who care about communication in technical contexts."
>
  <main>
    <!-- Hero Section -->
    <section class="section bg-gradient-to-b from-teal-200 to-teal-50">
      <div class="container-md text-center">
        <h1 class="heading-hero mb-6" set:html={formatMarkdown(page.hero.headline)} />
        <p class="text-xl md:text-2xl text-teal-900 mb-10 container-xs" set:html={formatMarkdown(page.hero.subheadline)} />
        <a href={ctaUrl} class="btn-primary">
          {page.cta.text}
        </a>
      </div>
    </section>

    <!-- Video Section -->
    <section class="section bg-white">
      <div class="container-sm">
        <div class="aspect-video bg-teal-100 rounded-xl flex items-center justify-center">
          <p class="text-teal-600 text-lg">[Video Embed Placeholder]</p>
        </div>
      </div>
    </section>

    <!-- Content Sections -->
    {page.sections.map((section, index) => {
      const bgClass = index % 2 === 0 ? 'bg-teal-50' : 'bg-white';
      return (
        <section class={`section ${bgClass}`} id={section.id}>
          <div class="container-sm">
            <h2 class="heading-section mb-8 text-center">{section.title}</h2>

            {section.content.map((block) => {
              if (block.type === 'paragraph') {
                return <p class={`text-lg text-teal-900 mb-6 ${block.centered ? 'text-center' : ''}`} set:html={formatMarkdown(block.text)} />;
              }
              if (block.type === 'divider') {
                return <hr class="border-t border-teal-200 my-8" />;
              }
              if (block.type === 'orderedList') {
                return (
                  <ol class="space-y-4 text-lg text-teal-900 mb-8 list-none">
                    {block.items.map((item, i) => (
                      <li class="flex items-baseline gap-3">
                        <span class="text-teal-600 font-bold">{i + 1}.</span>
                        <span set:html={formatMarkdown(item)} />
                      </li>
                    ))}
                  </ol>
                );
              }
              if (block.type === 'bulletList') {
                return (
                  <ul class="space-y-4 text-lg text-teal-900 mb-8">
                    {block.items.map((item) => (
                      <li class="flex items-baseline gap-3">
                        <span class="text-teal-600 font-bold">•</span>
                        <span set:html={formatMarkdown(item)} />
                      </li>
                    ))}
                  </ul>
                );
              }
              if (block.type === 'faq') {
                return (
                  <div class="space-y-6">
                    {block.questions.map((q) => (
                      <details class="group border border-teal-200 rounded-lg">
                        <summary class="flex items-center justify-between cursor-pointer p-4 text-lg font-medium text-teal-900 hover:bg-teal-50">
                          <span set:html={formatMarkdown(q.question)} />
                          <span class="text-teal-600 group-open:rotate-180 transition-transform">▼</span>
                        </summary>
                        <div class="px-4 pb-4 text-teal-900" set:html={formatMarkdown(q.answer)} />
                      </details>
                    ))}
                  </div>
                );
              }
              if (block.type === 'clarifications') {
                return (
                  <div>
                    {block.subtitle && <p class="text-lg text-teal-900 mb-6 text-center" set:html={formatMarkdown(block.subtitle)} />}
                    <div class="grid gap-6 md:grid-cols-2">
                      {block.items.map((item) => (
                        <div class="bg-white border border-teal-200 rounded-lg p-6">
                          <h3 class="font-bold text-teal-900 mb-2">{item.title}</h3>
                          <p class="text-teal-900" set:html={formatMarkdown(item.description)} />
                        </div>
                      ))}
                    </div>
                  </div>
                );
              }
              if (block.type === 'fit') {
                return (
                  <div class="grid gap-8 md:grid-cols-2">
                    <FitList type="good" items={block.goodFit} />
                    <FitList type="bad" items={block.notGoodFit} />
                  </div>
                );
              }
              if (block.type === 'cta') {
                return (
                  <div class="text-center mt-8">
                    <a href={ctaUrl} class="btn-primary">
                      {block.text}
                    </a>
                  </div>
                );
              }
              return null;
            })}
          </div>
        </section>
      );
    })}

    <!-- Final CTA -->
    <section class="section bg-teal-950 text-white">
      <div class="container-sm">
        <h2 class="heading-section !text-white mb-8 text-center">{page.cta.headline}</h2>

        <div class="bg-white rounded-xl p-8 md:p-10 shadow-lg text-center">
          <p class="text-xl text-teal-900 mb-8" set:html={formatMarkdown(page.cta.subtext)} />

          <a href={ctaUrl} class="btn-primary-lg">
            {page.cta.text}
          </a>
        </div>

        <p class="text-teal-200 text-sm text-center mt-6">
          Questions? Reach out to <a href={`mailto:${page.cta.email}`} class="text-teal-200 hover:text-white underline">{page.cta.email}</a>
        </p>
      </div>
    </section>

    <!-- Footer -->
    <footer class="py-8 px-6 bg-teal-950 border-t border-teal-900">
      <div class="container-md text-center">
        <p class="text-teal-400 text-sm">
          {page.footer.copyright}
        </p>
      </div>
    </footer>
  </main>
</Layout>
