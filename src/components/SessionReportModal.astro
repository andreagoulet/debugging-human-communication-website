---
import SessionReportContent from './SessionReportContent.astro';
---

<dialog
  id="session-report-modal"
  class="session-report-dialog"
  aria-label="Sample Discovery Session Report"
>
  <div class="dialog-inner">
    <div class="dialog-header">
      <h2 class="text-xl font-bold text-teal-950">Sample Session Report</h2>
      <button
        id="close-report-modal"
        class="dialog-close-btn"
        aria-label="Close report preview"
      >
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    <div class="dialog-body">
      <p class="text-sm text-teal-800 italic mb-4">
        Names and identifying details have been changed to protect privacy.
      </p>
      <SessionReportContent />
    </div>
  </div>
</dialog>

<style>
  .session-report-dialog {
    max-width: 48rem;
    max-height: 90vh;
    max-height: 90dvh;
    width: calc(100% - 2rem);
    border: none;
    border-radius: 1rem;
    padding: 0;
    margin: auto;
    overflow: hidden;
    box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
  }

  .session-report-dialog::backdrop {
    background: rgba(0, 54, 64, 0.7);
    backdrop-filter: blur(4px);
  }

  @media (prefers-reduced-motion: no-preference) {
    .session-report-dialog[open] {
      animation: dialog-fade-in 0.2s ease-out;
    }

    .session-report-dialog[open]::backdrop {
      animation: backdrop-fade-in 0.2s ease-out;
    }
  }

  @keyframes dialog-fade-in {
    from {
      opacity: 0;
      transform: translateY(1rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes backdrop-fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .dialog-inner {
    display: flex;
    flex-direction: column;
    max-height: 90vh;
    max-height: 90dvh;
  }

  .dialog-header {
    position: sticky;
    top: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--color-teal-200);
    background: white;
    z-index: 1;
  }

  .dialog-body {
    overflow-y: auto;
    padding: 1.5rem;
    -webkit-overflow-scrolling: touch;
  }

  .dialog-close-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.5rem;
    border: none;
    background: none;
    color: var(--color-teal-950);
    cursor: pointer;
    transition: background-color 0.15s;
  }

  .dialog-close-btn:hover {
    background: var(--color-teal-200);
  }

  .dialog-close-btn:focus-visible {
    outline: 2px solid var(--color-teal-600);
    outline-offset: 2px;
  }
</style>

<script>
  const dialog = document.getElementById('session-report-modal') as HTMLDialogElement;
  const closeBtn = document.getElementById('close-report-modal');
  const openBtn = document.getElementById('open-report-preview');

  openBtn?.addEventListener('click', () => {
    dialog.showModal();
    document.body.style.overflow = 'hidden';
    closeBtn?.focus();
  });

  closeBtn?.addEventListener('click', () => {
    dialog.close();
  });

  dialog?.addEventListener('click', (e) => {
    if (e.target === dialog) {
      dialog.close();
    }
  });

  dialog?.addEventListener('close', () => {
    document.body.style.overflow = '';
    openBtn?.focus();
  });
</script>
